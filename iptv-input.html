<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV URL Entry</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: 600;
        }
        
        .subtitle {
            text-align: center;
            opacity: 0.8;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }
        
        input[type="url"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }
        
        input[type="url"]::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        input[type="url"]:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.4);
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(238, 90, 36, 0.6);
        }
        
        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.4);
        }
        
        .status {
            margin-top: 20px;
            padding: 12px 16px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            min-height: 20px;
        }
        
        .status.success {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid rgba(39, 174, 96, 0.4);
            color: #2ecc71;
        }
        
        .status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.4);
            color: #e74c3c;
        }
        
        .status.info {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid rgba(52, 152, 219, 0.4);
            color: #3498db;
        }
        
        .examples {
            margin-top: 20px;
            font-size: 12px;
            opacity: 0.7;
        }
        
        .examples h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }
        
        .examples ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .examples li {
            margin-bottom: 4px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∫ IPTV Watch</h1>
        <div class="subtitle">Enter IPTV playlist URL for your device</div>
        
        <div class="form-group">
            <label for="urlInput">IPTV Playlist URL</label>
            <input 
                type="url" 
                id="urlInput" 
                placeholder="https://example.com/playlist.m3u8"
                autocomplete="url"
                spellcheck="false"
            >
        </div>
        
        <button class="button" onclick="sendUrl()" id="sendButton">
            Send to Device
        </button>
        
        <div id="status" class="status"></div>
        
        <div class="examples">
            <h3>Supported formats:</h3>
            <ul>
                <li>M3U/M3U8 playlists (.m3u, .m3u8)</li>
                <li>Xtream Codes API URLs</li>
                <li>Direct streaming URLs</li>
                <li>Panel API endpoints</li>
            </ul>

            <div style="margin-top: 20px; padding: 15px; background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 8px; font-size: 11px;">
                <strong>‚öñÔ∏è Legal Notice:</strong> This tool is designed for accessing legally owned IPTV content. Users are responsible for ensuring they have proper authorization to access any streaming content. Do not use this tool for accessing copyrighted material without permission.
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

        // Firebase configuration - Using weargb database with IPTV path
        const firebaseConfig = {
            apiKey: "AIzaSyBp8_V8jjEUq1aGuypS6VV63cFBFap0s6M",
            authDomain: "weargb.firebaseapp.com",
            databaseURL: "https://weargb-default-rtdb.firebaseio.com",
            projectId: "weargb",
            storageBucket: "weargb.firebasestorage.app",
            messagingSenderId: "480332250386",
            appId: "1:480332250386:web:9747cb"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Get session ID from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session');
        
        if (!sessionId) {
            document.getElementById('status').textContent = 'Error: No session ID found in URL';
            document.getElementById('status').className = 'status error';
            document.getElementById('sendButton').disabled = true;
        } else {
            document.getElementById('status').textContent = `Session: ${sessionId.substring(0, 8)}...`;
            document.getElementById('status').className = 'status info';
        }

        // Global function for sending URL to Firebase
        window.sendUrl = async function() {
            const urlInput = document.getElementById('urlInput');
            const sendButton = document.getElementById('sendButton');
            const status = document.getElementById('status');
            
            const url = urlInput.value.trim();
            
            if (!url) {
                status.textContent = 'Please enter a URL';
                status.className = 'status error';
                return;
            }
            
            // Validate URL format
            try {
                new URL(url);
            } catch (e) {
                status.textContent = 'Please enter a valid URL';
                status.className = 'status error';
                return;
            }
            
            // Check for IPTV playlist file extensions/patterns
            const validPatterns = ['.m3u', '.m3u8', 'get.php', 'player_api.php', 'output=ts', 'type=m3u'];
            const hasValidPattern = validPatterns.some(pattern => 
                url.toLowerCase().includes(pattern)
            );
            
            if (!hasValidPattern && !url.includes('://')) {
                const proceed = confirm(
                    'URL does not seem to contain a valid IPTV playlist format. Continue anyway?'
                );
                if (!proceed) return;
            }
            
            // Send URL to Firebase Realtime Database
            try {
                sendButton.disabled = true;
                sendButton.innerHTML = '<span class="loading"></span> Sending to Device...';
                status.textContent = 'Sending URL to your device...';
                status.className = 'status info';
                
                // Write to Firebase with session ID as key (using url-sessions path like wearGB)
                await set(ref(database, `url-sessions/${sessionId}`), {
                    url: url,
                    timestamp: Date.now(),
                    consumed: false
                });
                
                status.textContent = '‚úÖ URL sent successfully! Check your device.';
                status.className = 'status success';
                
                // Auto-close after 3 seconds
                setTimeout(() => {
                    try {
                        window.close();
                    } catch (e) {
                        // If we can't close (some browsers block this), show message
                        status.textContent = '‚úÖ Done! You can close this tab and check your device.';
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Error sending URL to Firebase:', error);
                status.textContent = 'Error: Could not send URL. Please try again.';
                status.className = 'status error';
                sendButton.disabled = false;
                sendButton.textContent = 'Send to Device';
            }
        };
        
        // Auto-focus the URL input for better UX
        document.getElementById('urlInput').focus();
        
        // Enable Enter key to submit
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendUrl();
            }
        });
        
        // Log session info for debugging
        console.log('IPTV URL Input - Session:', sessionId);
        console.log('Firebase initialized successfully');
    </script>
</body>
</html>