<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV URL Entry</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .input-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-type-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-type-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
            transform: scale(1.02);
        }

        .input-type-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .input-section {
            display: none;
        }

        .input-section.active {
            display: block;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: 600;
        }

        .subtitle {
            text-align: center;
            opacity: 0.8;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="url"],
        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }

        input[type="url"]::placeholder,
        input[type="text"]::placeholder,
        input[type="password"]::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        input[type="url"]:focus,
        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.2);
        }

        .button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.4);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(238, 90, 36, 0.6);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.4);
        }

        .status {
            margin-top: 20px;
            padding: 12px 16px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            min-height: 20px;
        }

        .status.success {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid rgba(39, 174, 96, 0.4);
            color: #2ecc71;
        }

        .status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.4);
            color: #e74c3c;
        }

        .status.info {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid rgba(52, 152, 219, 0.4);
            color: #3498db;
        }

        .status.warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.4);
            color: #f39c12;
        }

        .examples {
            margin-top: 20px;
            font-size: 12px;
            opacity: 0.7;
        }

        .examples h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .examples ul {
            margin: 0;
            padding-left: 20px;
        }

        .examples li {
            margin-bottom: 4px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .rate-limit-notice {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            font-size: 11px;
            text-align: center;
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px;
            }
        }
    </style>
    <script>
        // Language translations
        const translations = {
            it: {
                title: 'üì∫ IPTV Guarda',
                subtitle: 'Inserisci URL della playlist IPTV per il tuo dispositivo',
                urlLabel: 'URL Lista IPTV',
                urlPlaceholder: 'https://esempio.com/lista.m3u8',
                sendButton: 'Invia al Dispositivo',
                sending: 'Invio al Dispositivo...',
                spamProtection: 'üõ°Ô∏è Protezione Anti-Spam: Limitato a 10 sessioni simultanee. Le sessioni scadono dopo 10 minuti.',
                supportedFormats: 'Formati supportati:',
                format1: 'Liste M3U/M3U8 (.m3u, .m3u8)',
                format2: 'URL API Xtream Codes',
                format3: 'URL di streaming diretto',
                format4: 'Endpoint API Panel',
                legalNotice: '‚öñÔ∏è Avviso Legale: Questo strumento √® progettato per accedere a contenuti IPTV di propriet√† legale. Gli utenti sono responsabili di assicurarsi di avere l\'autorizzazione appropriata per accedere a qualsiasi contenuto di streaming. Non utilizzare questo strumento per accedere a materiale protetto da copyright senza autorizzazione.',
                errorNoSession: 'Errore: Nessun ID di sessione trovato nell\'URL',
                errorInvalidSession: 'Errore: Formato ID sessione non valido',
                sessionInfo: 'Sessione: ',
                rateLimited: 'Limite raggiunto. Attendere',
                seconds: 'secondi.',
                enterUrl: 'Inserisci un URL',
                invalidUrl: 'URL non valido: ',
                onlyHttpAllowed: 'Sono consentiti solo URL HTTP e HTTPS',
                localhostBlocked: 'URL localhost e privati non sono consentiti',
                invalidUrlFormat: 'Formato URL non valido',
                urlAccepted: 'URL accettato (nessun pattern IPTV rilevato)',
                validIptvUrl: 'URL IPTV valido',
                noIptvWarning: 'L\'URL non contiene pattern IPTV comuni. Continuare comunque?',
                sendingToDevice: 'Invio URL al tuo dispositivo...',
                successMessage: '‚úÖ URL inviato con successo! Controlla il tuo dispositivo.',
                successClose: '‚úÖ Fatto! Puoi chiudere questa scheda e controllare il tuo dispositivo.',
                errorSending: 'Errore: Impossibile inviare l\'URL. Riprova.',
                sessionAlreadyUsed: '‚ö†Ô∏è Questa sessione √® gi√† stata utilizzata. Scansiona un nuovo codice QR.',
                checkingSession: 'Controllo stato sessione...',
                directUrl: 'URL Diretto',
                xtreamCodes: 'Codici Xtream',
                serverUrl: 'URL Server',
                serverUrlPlaceholder: 'http://esempio.com:8080',
                username: 'Nome utente',
                usernamePlaceholder: 'Il tuo nome utente',
                password: 'Password',
                passwordPlaceholder: 'La tua password',
                converting: 'Conversione in URL IPTV...',
                invalidXtream: 'Compila tutti i campi Xtream Codes'
            },
            ja: {
                title: 'üì∫ IPTV„Ç¶„Ç©„ÉÉ„ÉÅ',
                subtitle: '„Éá„Éê„Ç§„ÇπÁî®„ÅÆIPTV„Éó„É¨„Ç§„É™„Çπ„ÉàURL„ÇíÂÖ•Âäõ',
                urlLabel: 'IPTV„Éó„É¨„Ç§„É™„Çπ„ÉàURL',
                urlPlaceholder: 'https://example.com/playlist.m3u8',
                sendButton: '„Éá„Éê„Ç§„Çπ„Å´ÈÄÅ‰ø°',
                sending: '„Éá„Éê„Ç§„Çπ„Å´ÈÄÅ‰ø°‰∏≠...',
                spamProtection: 'üõ°Ô∏è „Çπ„Éë„É†‰øùË≠∑Ôºö10„ÅÆÂêåÊôÇ„Çª„ÉÉ„Ç∑„Éß„É≥„Å´Âà∂Èôê„ÄÇ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅØ10ÂàÜÂæå„Å´ÊúüÈôêÂàá„Çå„ÄÇ',
                supportedFormats: '„Çµ„Éù„Éº„ÉàÂΩ¢Âºè:',
                format1: 'M3U/M3U8„Éó„É¨„Ç§„É™„Çπ„Éà (.m3u, .m3u8)',
                format2: 'Xtream Codes API URL',
                format3: '„ÉÄ„Ç§„É¨„ÇØ„Éà„Çπ„Éà„É™„Éº„Éü„É≥„Ç∞URL',
                format4: '„Éë„Éç„É´API„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà',
                legalNotice: '‚öñÔ∏è Ê≥ïÁöÑÈÄöÁü•Ôºö„Åì„ÅÆ„ÉÑ„Éº„É´„ÅØÂêàÊ≥ïÁöÑ„Å´ÊâÄÊúâ„Åï„Çå„Å¶„ÅÑ„ÇãIPTV„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Å´„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Åü„ÇÅ„Å´Ë®≠Ë®à„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ',
                errorNoSession: '„Ç®„É©„ÉºÔºöURL„Å´„Çª„ÉÉ„Ç∑„Éß„É≥ID„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì',
                errorInvalidSession: '„Ç®„É©„ÉºÔºöÁÑ°Âäπ„Å™„Çª„ÉÉ„Ç∑„Éß„É≥IDÂΩ¢Âºè',
                sessionInfo: '„Çª„ÉÉ„Ç∑„Éß„É≥: ',
                rateLimited: '„É¨„Éº„ÉàÂà∂Èôê„ÄÇÂæÖ„Å£„Å¶„Åè„Å†„Åï„ÅÑ',
                seconds: 'Áßí„ÄÇ',
                enterUrl: 'URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                invalidUrl: 'ÁÑ°Âäπ„Å™URL: ',
                onlyHttpAllowed: 'HTTP„Å®HTTPS URL„ÅÆ„ÅøË®±ÂèØ',
                localhostBlocked: 'localhost„Å®„Éó„É©„Ç§„Éô„Éº„ÉàURL„ÅØË®±ÂèØ„Åï„Çå„Åæ„Åõ„Çì',
                invalidUrlFormat: 'ÁÑ°Âäπ„Å™URLÂΩ¢Âºè',
                urlAccepted: 'URLÊâøË™çÊ∏à„ÅøÔºàIPTV„Éë„Çø„Éº„É≥Êú™Ê§úÂá∫Ôºâ',
                validIptvUrl: 'ÊúâÂäπ„Å™IPTV URL',
                noIptvWarning: 'URL„Å´‰∏ÄËà¨ÁöÑ„Å™IPTV„Éë„Çø„Éº„É≥„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÁ∂öË°å„Åó„Åæ„Åô„ÅãÔºü',
                sendingToDevice: '„Éá„Éê„Ç§„Çπ„Å´URL„ÇíÈÄÅ‰ø°‰∏≠...',
                successMessage: '‚úÖ URL„ÅåÊ≠£Â∏∏„Å´ÈÄÅ‰ø°„Åï„Çå„Åæ„Åó„ÅüÔºÅ„Éá„Éê„Ç§„Çπ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                successClose: '‚úÖ ÂÆå‰∫ÜÔºÅ„Åì„ÅÆ„Çø„Éñ„ÇíÈñâ„Åò„Å¶„Éá„Éê„Ç§„Çπ„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ',
                errorSending: '„Ç®„É©„ÉºÔºöURL„ÇíÈÄÅ‰ø°„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ',
                sessionAlreadyUsed: '‚ö†Ô∏è „Åì„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅØÊó¢„Å´‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÊñ∞„Åó„ÅÑQR„Ç≥„Éº„Éâ„Çí„Çπ„Ç≠„É£„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                checkingSession: '„Çª„ÉÉ„Ç∑„Éß„É≥Áä∂ÊÖã„ÇíÁ¢∫Ë™ç‰∏≠...',
                directUrl: 'Áõ¥Êé•URL',
                xtreamCodes: 'Xtream„Ç≥„Éº„Éâ',
                serverUrl: '„Çµ„Éº„Éê„ÉºURL',
                serverUrlPlaceholder: 'http://example.com:8080',
                username: '„É¶„Éº„Ç∂„ÉºÂêç',
                usernamePlaceholder: '„ÅÇ„Å™„Åü„ÅÆ„É¶„Éº„Ç∂„ÉºÂêç',
                password: '„Éë„Çπ„ÉØ„Éº„Éâ',
                passwordPlaceholder: '„ÅÇ„Å™„Åü„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ',
                converting: 'IPTV URL„Å´Â§âÊèõ‰∏≠...',
                invalidXtream: '„Åô„Åπ„Å¶„ÅÆXtream Codes„Éï„Ç£„Éº„É´„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'
            },
            pt: {
                title: 'üì∫ IPTV Assistir',
                subtitle: 'Digite a URL da lista IPTV para seu dispositivo',
                urlLabel: 'URL da Lista IPTV',
                urlPlaceholder: 'https://exemplo.com/lista.m3u8',
                sendButton: 'Enviar para Dispositivo',
                sending: 'Enviando para Dispositivo...',
                spamProtection: 'üõ°Ô∏è Prote√ß√£o Anti-Spam: Limitado a 10 sess√µes simult√¢neas. Sess√µes expiram ap√≥s 10 minutos.',
                supportedFormats: 'Formatos suportados:',
                format1: 'Listas M3U/M3U8 (.m3u, .m3u8)',
                format2: 'URLs da API Xtream Codes',
                format3: 'URLs de streaming direto',
                format4: 'Endpoints da API do Painel',
                legalNotice: '‚öñÔ∏è Aviso Legal: Esta ferramenta √© projetada para acessar conte√∫do IPTV de propriedade legal. Os usu√°rios s√£o respons√°veis por garantir que t√™m autoriza√ß√£o adequada para acessar qualquer conte√∫do de streaming. N√£o use esta ferramenta para acessar material protegido por direitos autorais sem permiss√£o.',
                errorNoSession: 'Erro: Nenhum ID de sess√£o encontrado na URL',
                errorInvalidSession: 'Erro: Formato de ID de sess√£o inv√°lido',
                sessionInfo: 'Sess√£o: ',
                rateLimited: 'Limite atingido. Por favor aguarde',
                seconds: 'segundos.',
                enterUrl: 'Por favor, insira uma URL',
                invalidUrl: 'URL inv√°lida: ',
                onlyHttpAllowed: 'Apenas URLs HTTP e HTTPS s√£o permitidas',
                localhostBlocked: 'URLs localhost e privadas n√£o s√£o permitidas',
                invalidUrlFormat: 'Formato de URL inv√°lido',
                urlAccepted: 'URL aceita (nenhum padr√£o IPTV detectado)',
                validIptvUrl: 'URL IPTV v√°lida',
                noIptvWarning: 'A URL n√£o cont√©m padr√µes IPTV comuns. Continuar mesmo assim?',
                sendingToDevice: 'Enviando URL para seu dispositivo...',
                successMessage: '‚úÖ URL enviada com sucesso! Verifique seu dispositivo.',
                successClose: '‚úÖ Pronto! Voc√™ pode fechar esta aba e verificar seu dispositivo.',
                errorSending: 'Erro: N√£o foi poss√≠vel enviar a URL. Por favor, tente novamente.',
                sessionAlreadyUsed: '‚ö†Ô∏è Esta sess√£o j√° foi usada. Por favor, escaneie um novo c√≥digo QR.',
                checkingSession: 'Verificando status da sess√£o...',
                directUrl: 'URL Direta',
                xtreamCodes: 'C√≥digos Xtream',
                serverUrl: 'URL do Servidor',
                serverUrlPlaceholder: 'http://exemplo.com:8080',
                username: 'Nome de usu√°rio',
                usernamePlaceholder: 'Seu nome de usu√°rio',
                password: 'Senha',
                passwordPlaceholder: 'Sua senha',
                converting: 'Convertendo para URL IPTV...',
                invalidXtream: 'Por favor, preencha todos os campos do Xtream Codes'
            },
            en: {
                title: 'üì∫ IPTV Watch',
                subtitle: 'Enter IPTV playlist URL for your device',
                urlLabel: 'IPTV Playlist URL',
                urlPlaceholder: 'https://example.com/playlist.m3u8',
                sendButton: 'Send to Device',
                sending: 'Sending to Device...',
                spamProtection: 'üõ°Ô∏è Spam Protection: Limited to 10 simultaneous sessions. Sessions expire after 10 minutes.',
                supportedFormats: 'Supported formats:',
                format1: 'M3U/M3U8 playlists (.m3u, .m3u8)',
                format2: 'Xtream Codes API URLs',
                format3: 'Direct streaming URLs',
                format4: 'Panel API endpoints',
                legalNotice: '‚öñÔ∏è Legal Notice: This tool is designed for accessing legally owned IPTV content. Users are responsible for ensuring they have proper authorization to access any streaming content. Do not use this tool for accessing copyrighted material without permission.',
                errorNoSession: 'Error: No session ID found in URL',
                errorInvalidSession: 'Error: Invalid session ID format',
                sessionInfo: 'Session: ',
                rateLimited: 'Rate limited. Please wait',
                seconds: 'seconds.',
                enterUrl: 'Please enter a URL',
                invalidUrl: 'Invalid URL: ',
                onlyHttpAllowed: 'Only HTTP and HTTPS URLs are allowed',
                localhostBlocked: 'Localhost and private URLs are not allowed',
                invalidUrlFormat: 'Invalid URL format',
                urlAccepted: 'URL accepted (no IPTV patterns detected)',
                validIptvUrl: 'Valid IPTV URL',
                noIptvWarning: 'URL does not contain common IPTV patterns. Continue anyway?',
                sendingToDevice: 'Sending URL to your device...',
                successMessage: '‚úÖ URL sent successfully! Check your device.',
                successClose: '‚úÖ Done! You can close this tab and check your device.',
                errorSending: 'Error: Could not send URL. Please try again.',
                sessionAlreadyUsed: '‚ö†Ô∏è This session has already been used. Please scan a new QR code.',
                checkingSession: 'Checking session status...',
                directUrl: 'Direct URL',
                xtreamCodes: 'Xtream Codes',
                serverUrl: 'Server URL',
                serverUrlPlaceholder: 'http://example.com:8080',
                username: 'Username',
                usernamePlaceholder: 'Your username',
                password: 'Password',
                passwordPlaceholder: 'Your password',
                converting: 'Converting to IPTV URL...',
                invalidXtream: 'Please fill in all Xtream Codes fields'
            },
            es: {
                title: 'üì∫ IPTV Ver',
                subtitle: 'Ingrese la URL de la lista IPTV para su dispositivo',
                urlLabel: 'URL de Lista IPTV',
                urlPlaceholder: 'https://ejemplo.com/lista.m3u8',
                sendButton: 'Enviar al Dispositivo',
                sending: 'Enviando al Dispositivo...',
                spamProtection: 'üõ°Ô∏è Protecci√≥n Anti-Spam: Limitado a 10 sesiones simult√°neas. Las sesiones expiran despu√©s de 10 minutos.',
                supportedFormats: 'Formatos soportados:',
                format1: 'Listas M3U/M3U8 (.m3u, .m3u8)',
                format2: 'URLs de API Xtream Codes',
                format3: 'URLs de streaming directo',
                format4: 'Endpoints de API Panel',
                legalNotice: '‚öñÔ∏è Aviso Legal: Esta herramienta est√° dise√±ada para acceder a contenido IPTV de propiedad legal. Los usuarios son responsables de asegurarse de tener la autorizaci√≥n adecuada para acceder a cualquier contenido de streaming. No use esta herramienta para acceder a material con derechos de autor sin permiso.',
                errorNoSession: 'Error: No se encontr√≥ ID de sesi√≥n en la URL',
                errorInvalidSession: 'Error: Formato de ID de sesi√≥n inv√°lido',
                sessionInfo: 'Sesi√≥n: ',
                rateLimited: 'L√≠mite alcanzado. Por favor espere',
                seconds: 'segundos.',
                enterUrl: 'Por favor ingrese una URL',
                invalidUrl: 'URL inv√°lida: ',
                onlyHttpAllowed: 'Solo se permiten URLs HTTP y HTTPS',
                localhostBlocked: 'No se permiten URLs localhost y privadas',
                invalidUrlFormat: 'Formato de URL inv√°lido',
                urlAccepted: 'URL aceptada (no se detectaron patrones IPTV)',
                validIptvUrl: 'URL IPTV v√°lida',
                noIptvWarning: 'La URL no contiene patrones IPTV comunes. ¬øContinuar de todos modos?',
                sendingToDevice: 'Enviando URL a su dispositivo...',
                successMessage: '‚úÖ ¬°URL enviada con √©xito! Verifique su dispositivo.',
                successClose: '‚úÖ ¬°Listo! Puede cerrar esta pesta√±a y verificar su dispositivo.',
                errorSending: 'Error: No se pudo enviar la URL. Por favor intente de nuevo.',
                sessionAlreadyUsed: '‚ö†Ô∏è Esta sesi√≥n ya ha sido utilizada. Por favor escanee un nuevo c√≥digo QR.',
                checkingSession: 'Verificando estado de la sesi√≥n...',
                directUrl: 'URL Directa',
                xtreamCodes: 'C√≥digos Xtream',
                serverUrl: 'URL del Servidor',
                serverUrlPlaceholder: 'http://ejemplo.com:8080',
                username: 'Usuario',
                usernamePlaceholder: 'Su nombre de usuario',
                password: 'Contrase√±a',
                passwordPlaceholder: 'Su contrase√±a',
                converting: 'Convirtiendo a URL IPTV...',
                invalidXtream: 'Por favor complete todos los campos de Xtream Codes'
            },
            fr: {
                title: 'üì∫ IPTV Regarder',
                subtitle: "Entrez l'URL de la liste IPTV pour votre appareil",
                urlLabel: 'URL de la Liste IPTV',
                urlPlaceholder: 'https://exemple.com/liste.m3u8',
                sendButton: "Envoyer √† l'Appareil",
                sending: "Envoi √† l'Appareil...",
                spamProtection: 'üõ°Ô∏è Protection Anti-Spam: Limit√© √† 10 sessions simultan√©es. Les sessions expirent apr√®s 10 minutes.',
                supportedFormats: 'Formats support√©s:',
                format1: 'Listes M3U/M3U8 (.m3u, .m3u8)',
                format2: 'URLs API Xtream Codes',
                format3: 'URLs de streaming direct',
                format4: 'Points de terminaison API Panel',
                legalNotice: "‚öñÔ∏è Avis L√©gal: Cet outil est con√ßu pour acc√©der au contenu IPTV l√©galement poss√©d√©. Les utilisateurs sont responsables de s'assurer qu'ils ont l'autorisation appropri√©e pour acc√©der √† tout contenu de streaming. N'utilisez pas cet outil pour acc√©der √† du mat√©riel prot√©g√© par des droits d'auteur sans autorisation.",
                errorNoSession: 'Erreur: Aucun ID de session trouv√© dans l\'URL',
                errorInvalidSession: 'Erreur: Format d\'ID de session invalide',
                sessionInfo: 'Session: ',
                rateLimited: 'Limite atteinte. Veuillez attendre',
                seconds: 'secondes.',
                enterUrl: 'Veuillez entrer une URL',
                invalidUrl: 'URL invalide: ',
                onlyHttpAllowed: 'Seules les URLs HTTP et HTTPS sont autoris√©es',
                localhostBlocked: 'Les URLs localhost et priv√©es ne sont pas autoris√©es',
                invalidUrlFormat: 'Format d\'URL invalide',
                urlAccepted: 'URL accept√©e (aucun mod√®le IPTV d√©tect√©)',
                validIptvUrl: 'URL IPTV valide',
                noIptvWarning: "L'URL ne contient pas de mod√®les IPTV courants. Continuer quand m√™me?",
                sendingToDevice: 'Envoi de l\'URL √† votre appareil...',
                successMessage: '‚úÖ URL envoy√©e avec succ√®s! V√©rifiez votre appareil.',
                successClose: '‚úÖ Termin√©! Vous pouvez fermer cet onglet et v√©rifier votre appareil.',
                errorSending: 'Erreur: Impossible d\'envoyer l\'URL. Veuillez r√©essayer.',
                sessionAlreadyUsed: '‚ö†Ô∏è Cette session a d√©j√† √©t√© utilis√©e. Veuillez scanner un nouveau code QR.',
                checkingSession: 'V√©rification du statut de la session...',
                directUrl: 'URL Directe',
                xtreamCodes: 'Codes Xtream',
                serverUrl: 'URL du Serveur',
                serverUrlPlaceholder: 'http://exemple.com:8080',
                username: 'Nom d\'utilisateur',
                usernamePlaceholder: 'Votre nom d\'utilisateur',
                password: 'Mot de passe',
                passwordPlaceholder: 'Votre mot de passe',
                converting: 'Conversion en URL IPTV...',
                invalidXtream: 'Veuillez remplir tous les champs Xtream Codes'
            },
            de: {
                title: 'üì∫ IPTV Ansehen',
                subtitle: 'Geben Sie die IPTV-Playlist-URL f√ºr Ihr Ger√§t ein',
                urlLabel: 'IPTV-Playlist-URL',
                urlPlaceholder: 'https://beispiel.com/playlist.m3u8',
                sendButton: 'An Ger√§t senden',
                sending: 'An Ger√§t senden...',
                spamProtection: 'üõ°Ô∏è Spam-Schutz: Begrenzt auf 10 gleichzeitige Sitzungen. Sitzungen laufen nach 10 Minuten ab.',
                supportedFormats: 'Unterst√ºtzte Formate:',
                format1: 'M3U/M3U8-Playlisten (.m3u, .m3u8)',
                format2: 'Xtream Codes API-URLs',
                format3: 'Direkte Streaming-URLs',
                format4: 'Panel-API-Endpunkte',
                legalNotice: '‚öñÔ∏è Rechtlicher Hinweis: Dieses Tool ist f√ºr den Zugriff auf legal besessene IPTV-Inhalte konzipiert. Benutzer sind daf√ºr verantwortlich, sicherzustellen, dass sie die richtige Berechtigung haben, auf Streaming-Inhalte zuzugreifen. Verwenden Sie dieses Tool nicht, um ohne Erlaubnis auf urheberrechtlich gesch√ºtztes Material zuzugreifen.',
                errorNoSession: 'Fehler: Keine Sitzungs-ID in URL gefunden',
                errorInvalidSession: 'Fehler: Ung√ºltiges Sitzungs-ID-Format',
                sessionInfo: 'Sitzung: ',
                rateLimited: 'Limit erreicht. Bitte warten Sie',
                seconds: 'Sekunden.',
                enterUrl: 'Bitte geben Sie eine URL ein',
                invalidUrl: 'Ung√ºltige URL: ',
                onlyHttpAllowed: 'Nur HTTP- und HTTPS-URLs sind erlaubt',
                localhostBlocked: 'Localhost- und private URLs sind nicht erlaubt',
                invalidUrlFormat: 'Ung√ºltiges URL-Format',
                urlAccepted: 'URL akzeptiert (keine IPTV-Muster erkannt)',
                validIptvUrl: 'G√ºltige IPTV-URL',
                noIptvWarning: 'URL enth√§lt keine g√§ngigen IPTV-Muster. Trotzdem fortfahren?',
                sendingToDevice: 'URL wird an Ihr Ger√§t gesendet...',
                successMessage: '‚úÖ URL erfolgreich gesendet! √úberpr√ºfen Sie Ihr Ger√§t.',
                successClose: '‚úÖ Fertig! Sie k√∂nnen diese Registerkarte schlie√üen und Ihr Ger√§t √ºberpr√ºfen.',
                errorSending: 'Fehler: URL konnte nicht gesendet werden. Bitte versuchen Sie es erneut.',
                sessionAlreadyUsed: '‚ö†Ô∏è Diese Sitzung wurde bereits verwendet. Bitte scannen Sie einen neuen QR-Code.',
                checkingSession: 'Sitzungsstatus wird √ºberpr√ºft...',
                directUrl: 'Direkte URL',
                xtreamCodes: 'Xtream Codes',
                serverUrl: 'Server-URL',
                serverUrlPlaceholder: 'http://beispiel.com:8080',
                username: 'Benutzername',
                usernamePlaceholder: 'Ihr Benutzername',
                password: 'Passwort',
                passwordPlaceholder: 'Ihr Passwort',
                converting: 'Konvertierung zu IPTV-URL...',
                invalidXtream: 'Bitte f√ºllen Sie alle Xtream Codes-Felder aus'
            }
        };

        // Function to get user's preferred language
        function getUserLanguage() {
            const urlParams = new URLSearchParams(window.location.search);
            const langParam = urlParams.get('lang');
            if (langParam && translations[langParam]) {
                return langParam;
            }

            const browserLang = navigator.language.substring(0, 2);
            if (translations[browserLang]) {
                return browserLang;
            }

            // Default to English if no match
            return 'en';
        }

        // Get current language
        const currentLang = getUserLanguage();
        const t = translations[currentLang];

        // Update document language
        document.documentElement.lang = currentLang;
    </script>
</head>
<body>
    <div class="container">
        <h1>üì∫ IPTV Watch</h1>
        <div class="subtitle">Enter IPTV playlist URL for your device</div>

        <!-- Input Type Selector -->
        <div class="input-type-selector">
            <button class="input-type-btn active" id="urlBtn" onclick="switchInputType('url')">
                üåê <span id="directUrlLabel">Direct URL</span>
            </button>
            <button class="input-type-btn" id="xtreamBtn" onclick="switchInputType('xtream')">
                üîë <span id="xtreamCodesLabel">Xtream Codes</span>
            </button>
        </div>

        <!-- Direct URL Input Section -->
        <div class="input-section active" id="urlSection">
            <div class="form-group">
                <label for="urlInput">IPTV Playlist URL</label>
                <input
                    type="url"
                    id="urlInput"
                    placeholder="https://example.com/playlist.m3u8"
                    autocomplete="url"
                    spellcheck="false"
                >
            </div>
        </div>

        <!-- Xtream Codes Input Section -->
        <div class="input-section" id="xtreamSection">
            <div class="form-group">
                <label for="serverInput" id="serverLabel">Server URL</label>
                <input
                    type="url"
                    id="serverInput"
                    placeholder="http://example.com:8080"
                    autocomplete="url"
                    spellcheck="false"
                >
            </div>
            <div class="form-group">
                <label for="usernameInput" id="usernameLabel">Username</label>
                <input
                    type="text"
                    id="usernameInput"
                    placeholder="Your username"
                    autocomplete="username"
                    spellcheck="false"
                >
            </div>
            <div class="form-group">
                <label for="passwordInput" id="passwordLabel">Password</label>
                <input
                    type="password"
                    id="passwordInput"
                    placeholder="Your password"
                    autocomplete="current-password"
                    spellcheck="false"
                >
            </div>
        </div>

        <button class="button" onclick="sendUrl()" id="sendButton">
            Send to Device
        </button>

        <div id="status" class="status"></div>

        <div class="rate-limit-notice">
            <strong>üõ°Ô∏è Spam Protection:</strong> Limited to 10 simultaneous sessions. Sessions expire after 10 minutes.
        </div>

        <div class="examples">
            <h3>Supported formats:</h3>
            <ul>
                <li>M3U/M3U8 playlists (.m3u, .m3u8)</li>
                <li>Xtream Codes API URLs</li>
                <li>Direct streaming URLs</li>
                <li>Panel API endpoints</li>
            </ul>

            <div style="margin-top: 20px; padding: 15px; background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 8px; font-size: 11px;">
                <strong>‚öñÔ∏è Legal Notice:</strong> This tool is designed for accessing legally owned IPTV content. Users are responsible for ensuring they have proper authorization to access any streaming content. Do not use this tool for accessing copyrighted material without permission.
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

        // Firebase configuration - Using weargb database with IPTV path
        const firebaseConfig = {
            apiKey: "AIzaSyBp8_V8jjEUq1aGuypS6VV63cFBFap0s6M",
            authDomain: "weargb.firebaseapp.com",
            databaseURL: "https://weargb-default-rtdb.firebaseio.com",
            projectId: "weargb",
            storageBucket: "weargb.firebasestorage.app",
            messagingSenderId: "480332250386",
            appId: "1:480332250386:web:9747cb"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Rate limiting state
        let submitAttempts = 0;
        const MAX_ATTEMPTS_PER_SESSION = 3;
        const RATE_LIMIT_RESET_TIME = 60000; // 1 minute
        let lastAttemptTime = 0;

        // Get session ID from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session');

        if (!sessionId) {
            document.getElementById('status').textContent = t.errorNoSession;
            document.getElementById('status').className = 'status error';
            document.getElementById('sendButton').disabled = true;
        } else if (!isValidSessionFormat(sessionId)) {
            document.getElementById('status').textContent = t.errorInvalidSession;
            document.getElementById('status').className = 'status error';
            document.getElementById('sendButton').disabled = true;
        } else {
            document.getElementById('status').textContent = t.sessionInfo + sessionId.substring(0, 8) + '...';
            document.getElementById('status').className = 'status info';

            // Check if session has already been consumed on page load
            fetch(`https://weargb-default-rtdb.firebaseio.com/url-sessions/${sessionId}.json`)
                .then(response => response.json())
                .then(sessionData => {
                    if (sessionData && sessionData.consumed === true) {
                        document.getElementById('status').textContent = t.sessionAlreadyUsed;
                        document.getElementById('status').className = 'status error';
                        document.getElementById('sendButton').disabled = true;
                        document.getElementById('urlInput').disabled = true;
                    }
                })
                .catch(error => {
                    console.log('Could not check session status:', error);
                });
        }

        // Validate session ID format (UUID)
        function isValidSessionFormat(sessionId) {
            const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
            return uuidRegex.test(sessionId);
        }

        // Check rate limiting
        function isRateLimited() {
            const now = Date.now();

            // Reset counter if enough time has passed
            if (now - lastAttemptTime > RATE_LIMIT_RESET_TIME) {
                submitAttempts = 0;
            }

            return submitAttempts >= MAX_ATTEMPTS_PER_SESSION;
        }

        // Validate URL for IPTV patterns and security
        function validateUrl(url) {
            try {
                const urlObj = new URL(url);

                // Must be HTTP or HTTPS
                if (!['http:', 'https:'].includes(urlObj.protocol)) {
                    return { valid: false, reason: t.onlyHttpAllowed };
                }

                // Block localhost and private IP ranges
                const blockedPatterns = [
                    'localhost', '127.0.0.1', '192.168.', '10.0.', '172.',
                    'file://', 'ftp://', 'javascript:', 'data:'
                ];

                const isBlocked = blockedPatterns.some(pattern =>
                    url.toLowerCase().includes(pattern)
                );

                if (isBlocked) {
                    return { valid: false, reason: t.localhostBlocked };
                }

                // Check for IPTV patterns (warn but allow)
                const iptvPatterns = ['.m3u', '.m3u8', 'get.php', 'player_api.php', 'output=ts', 'type=m3u'];
                const hasIptvPattern = iptvPatterns.some(pattern =>
                    url.toLowerCase().includes(pattern)
                );

                return {
                    valid: true,
                    hasIptvPattern: hasIptvPattern,
                    reason: hasIptvPattern ? t.validIptvUrl : t.urlAccepted
                };

            } catch (e) {
                return { valid: false, reason: t.invalidUrlFormat };
            }
        }

        // Function to switch between input types
        window.switchInputType = function(type) {
            // Update active button
            document.getElementById('urlBtn').classList.toggle('active', type === 'url');
            document.getElementById('xtreamBtn').classList.toggle('active', type === 'xtream');

            // Show/hide sections
            document.getElementById('urlSection').classList.toggle('active', type === 'url');
            document.getElementById('xtreamSection').classList.toggle('active', type === 'xtream');
        };

        // Function to convert Xtream Codes to IPTV URL
        function convertXtreamToUrl(server, username, password) {
            // Remove trailing slash from server if present
            server = server.replace(/\/$/, '');

            // Build Xtream Codes API URL for M3U playlist
            // Format: http://server:port/get.php?username=XXX&password=XXX&type=m3u_plus&output=ts
            return `${server}/get.php?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}&type=m3u_plus&output=ts`;
        }

        // Global function for sending URL to Firebase
        window.sendUrl = async function() {
            const urlInput = document.getElementById('urlInput');
            const sendButton = document.getElementById('sendButton');
            const status = document.getElementById('status');

            // Determine which input type is active
            const isXtreamMode = document.getElementById('xtreamSection').classList.contains('active');
            let url = '';

            if (isXtreamMode) {
                // Get Xtream Codes inputs
                const serverUrl = document.getElementById('serverInput').value.trim();
                const username = document.getElementById('usernameInput').value.trim();
                const password = document.getElementById('passwordInput').value.trim();

                // Validate Xtream inputs
                if (!serverUrl || !username || !password) {
                    status.textContent = t.invalidXtream;
                    status.className = 'status error';
                    return;
                }

                // Convert Xtream Codes to IPTV URL
                status.textContent = t.converting;
                status.className = 'status info';
                url = convertXtreamToUrl(serverUrl, username, password);
                console.log('Converted Xtream Codes to URL:', url);
            } else {
                // Get direct URL input
                const urlInput = document.getElementById('urlInput');
                url = urlInput.value.trim();
            }

            // Rate limiting check
            if (isRateLimited()) {
                status.textContent = t.rateLimited + ' ' + Math.ceil((RATE_LIMIT_RESET_TIME - (Date.now() - lastAttemptTime)) / 1000) + ' ' + t.seconds;
                status.className = 'status warning';
                return;
            }

            if (!url) {
                status.textContent = t.enterUrl;
                status.className = 'status error';
                return;
            }

            // Validate URL
            const validation = validateUrl(url);
            if (!validation.valid) {
                status.textContent = t.invalidUrl + validation.reason;
                status.className = 'status error';
                return;
            }

            // Show warning for non-IPTV URLs
            if (!validation.hasIptvPattern) {
                const proceed = confirm(t.noIptvWarning);
                if (!proceed) return;
            }

            // Update rate limiting
            submitAttempts++;
            lastAttemptTime = Date.now();

            // Send URL to Firebase Realtime Database
            try {
                sendButton.disabled = true;
                sendButton.innerHTML = '<span class="loading"></span> ' + t.checkingSession;
                status.textContent = t.checkingSession;
                status.className = 'status info';

                // First check if session has already been consumed
                const checkResponse = await fetch(`https://weargb-default-rtdb.firebaseio.com/url-sessions/${sessionId}.json`);
                if (checkResponse.ok) {
                    const sessionData = await checkResponse.json();
                    if (sessionData && sessionData.consumed === true) {
                        status.textContent = t.sessionAlreadyUsed;
                        status.className = 'status error';
                        sendButton.disabled = false;
                        sendButton.textContent = t.sendButton;
                        return;
                    }
                }

                sendButton.innerHTML = '<span class="loading"></span> ' + t.sending;
                status.textContent = t.sendingToDevice;

                // Write to Firebase with session ID as key (using url-sessions path like wearGB)
                await set(ref(database, `url-sessions/${sessionId}`), {
                    url: url,
                    timestamp: Date.now(),
                    consumed: false,
                    userAgent: navigator.userAgent.substring(0, 100), // Limited info for debugging
                    iptvValidation: validation.hasIptvPattern
                });

                status.textContent = t.successMessage;
                status.className = 'status success';

                // Auto-close after 3 seconds
                setTimeout(() => {
                    try {
                        window.close();
                    } catch (e) {
                        // If we can't close (some browsers block this), show message
                        status.textContent = t.successClose;
                    }
                }, 3000);

            } catch (error) {
                console.error('Error sending URL to Firebase:', error);
                status.textContent = t.errorSending;
                status.className = 'status error';
                sendButton.disabled = false;
                sendButton.textContent = t.sendButton;
            }
        };

        // Initialize UI with translations
        document.addEventListener('DOMContentLoaded', function() {
            // Update all text content with translations
            document.querySelector('h1').textContent = t.title;
            document.querySelector('.subtitle').textContent = t.subtitle;

            // Direct URL section
            document.querySelector('label[for="urlInput"]').textContent = t.urlLabel;
            document.getElementById('urlInput').placeholder = t.urlPlaceholder;

            // Xtream Codes section
            document.getElementById('directUrlLabel').textContent = t.directUrl;
            document.getElementById('xtreamCodesLabel').textContent = t.xtreamCodes;
            document.getElementById('serverLabel').textContent = t.serverUrl;
            document.getElementById('serverInput').placeholder = t.serverUrlPlaceholder;
            document.getElementById('usernameLabel').textContent = t.username;
            document.getElementById('usernameInput').placeholder = t.usernamePlaceholder;
            document.getElementById('passwordLabel').textContent = t.password;
            document.getElementById('passwordInput').placeholder = t.passwordPlaceholder;

            document.getElementById('sendButton').textContent = t.sendButton;
            document.querySelector('.rate-limit-notice').innerHTML = t.spamProtection;
            document.querySelector('.examples h3').textContent = t.supportedFormats;
            const formatItems = document.querySelectorAll('.examples ul li');
            formatItems[0].textContent = t.format1;
            formatItems[1].textContent = t.format2;
            formatItems[2].textContent = t.format3;
            formatItems[3].textContent = t.format4;
            document.querySelector('.examples > div').innerHTML = t.legalNotice;

            // Auto-focus the URL input for better UX
            document.getElementById('urlInput').focus();
        });

        // Enable Enter key to submit for all inputs
        ['urlInput', 'serverInput', 'usernameInput', 'passwordInput'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendUrl();
                    }
                });
            }
        });

        // Log session info for debugging (limited info only)
        console.log('IPTV URL Input - Session:', sessionId ? sessionId.substring(0, 8) + '...' : 'none');
        console.log('Firebase initialized successfully');
        console.log('Language:', currentLang);
    </script>
</body>
</html>